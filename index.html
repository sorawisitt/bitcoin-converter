<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional Bitcoin, Satoshi, and Thai Baht converter with real-time Bitkub rates.">
    <title>Bitcoin Converter Pro (BTC, SAT, THB)</title>
    <link rel="icon" type="image/png" href="https://sorawisit.com/favcon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #f7931a;
            --primary-hover: #e07b00;
            --bg-body: #f8f9fa;
            --card-bg: rgba(255, 255, 255, 0.9);
            --text-main: #1a1a1a;
            --text-muted: #666666;
            --border: #e1e4e8;
            --input-bg: #ffffff;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --radius: 16px;
        }

        [data-theme="dark"] {
            --bg-body: #0f1113;
            --card-bg: rgba(26, 29, 33, 0.95);
            --text-main: #f1f3f5;
            --text-muted: #9ba1a6;
            --border: #2d3238;
            --input-bg: #111316;
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-container {
            width: 100%;
            max-width: 800px;
            margin-top: 2vh;
        }

        /* Glassmorphism Card */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            padding: 32px;
            margin-bottom: 24px;
            transition: border-color 0.3s ease;
        }

        header {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .btc-icon {
            font-size: 2.5rem;
            color: var(--primary);
        }

        h1 {
            font-weight: 700;
            font-size: 1.75rem;
            letter-spacing: -0.02em;
        }

        .credit {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .credit a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        /* Ticker Style */
        .live-ticker {
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .ticker-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: block;
        }

        .ticker-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }

        .sat-value {
            font-size: 0.9rem;
            color: var(--text-main);
            margin-top: 4px;
        }

        /* Input Grid */
        .converter-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 32px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            padding-left: 4px;
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-container input {
            width: 100%;
            padding: 14px 45px 14px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-main);
            transition: all 0.2s ease;
        }

        .input-container input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(247, 147, 26, 0.15);
        }

        .input-container .copy-btn {
            position: absolute;
            right: 12px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s;
        }

        .input-container .copy-btn:hover {
            color: var(--primary);
        }

        /* Controls */
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .btn {
            height: 42px; /* Fixed height for consistent alignment */
            padding: 0 18px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
            display: inline-flex;
            align-items: center;
            justify-content: center; /* Center horizontally */
            gap: 8px;
            line-height: 1; /* Reset line height for flex centering */
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-main);
        }

        .btn-outline:hover {
            background: var(--border);
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: #2fb344;
            font-weight: 600;
            height: 42px; /* Match button height for row symmetry */
        }

        .status-pill.offline { color: #f76707; }

        .dot {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Comparison Section */
        .comparison-section h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .comparison-card {
            background: var(--input-bg);
            border: 1px solid var(--border);
            padding: 16px;
            border-radius: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .comparison-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            color: var(--text-muted);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .item-name {
            color: var(--text-main);
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .item-thb {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .item-sat {
            font-family: 'JetBrains Mono', monospace;
            color: var(--primary);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .item-btc {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        footer {
            margin: 40px 0;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.8rem;
            line-height: 1.8;
        }

        footer a {
            color: inherit;
            text-decoration: underline;
        }

        /* Toast UI */
        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text-main);
            color: var(--bg-body);
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }

        #toast.show { transform: translateX(-50%) translateY(0); }

        @media (max-width: 600px) {
            .glass-card { padding: 20px; }
            .comparison-grid { grid-template-columns: 1fr; }
            .controls-row { flex-direction: column; align-items: stretch; }
            .btn { justify-content: center; }
            .status-pill { justify-content: center; }
        }
    </style>
</head>
<body>

    <div id="toast">Copied to clipboard!</div>

    <div class="main-container">
        <header>
            <div class="logo-area">
                <span class="btc-icon">â‚¿</span>
                <h1>Bitcoin Converter Pro</h1>
            </div>
            <p class="credit">Developed by <a href="https://x.com/sorawisitt" target="_blank">@SorawisitT</a></p>
        </header>

        <div class="glass-card">
            <div class="live-ticker" id="ticker-box">
                <span class="ticker-label">Current Exchange Rate</span>
                <div class="ticker-value" id="ticker-btc-thb">Fetching...</div>
                <div class="sat-value" id="ticker-thb-sat">---</div>
            </div>

            <div class="converter-grid">
                <div class="input-wrapper">
                    <label for="thb-input">Thai Baht (THB)</label>
                    <div class="input-container">
                        <input type="text" id="thb-input" placeholder="0" autocomplete="off">
                        <button class="copy-btn" onclick="copyValue('thb-input')" title="Copy">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                </div>

                <div class="input-wrapper">
                    <label for="sat-input">Satoshis (SAT)</label>
                    <div class="input-container">
                        <input type="text" id="sat-input" placeholder="0" autocomplete="off">
                        <button class="copy-btn" onclick="copyValue('sat-input')" title="Copy">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                </div>

                <div class="input-wrapper">
                    <label for="btc-input">Bitcoin (BTC)</label>
                    <div class="input-container">
                        <input type="text" id="btc-input" placeholder="0.00000000" autocomplete="off">
                        <button class="copy-btn" onclick="copyValue('btc-input')" title="Copy">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="controls-row">
                <div class="status-pill" id="status-pill">
                    <div class="dot"></div>
                    <span id="status-text">Live Sync</span>
                    <span id="countdown" style="margin-left: 8px; opacity: 0.6;"></span>
                </div>
                
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-outline" id="theme-toggle">
                        <span id="theme-icon">ðŸŒ“</span> <span id="theme-text">System</span>
                    </button>
                    <button class="btn btn-primary" id="refresh-btn">
                        ðŸ”„ Refresh
                    </button>
                </div>
            </div>
        </div>

        <div class="comparison-section">
            <h2>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary)"><path d="M3 6h18M3 12h18M3 18h18"></path></svg>
                The Bitcoin Standard
            </h2>
            <div class="comparison-grid" id="comparison-grid">
                <!-- Cards injected by JS -->
            </div>
        </div>

        <footer>
            Data provided by <a href="https://www.bitkub.com" target="_blank">Bitkub API</a><br>
            Bitcoin Standard visualization inspired by global purchasing power parity.<br>
            <a href="https://sorawisit.com" target="_blank">sorawisit.com</a> â€¢ <a href="https://pay.blink.sv/SORAWISIT" target="_blank">Donate SATs</a>
        </footer>
    </div>

    <script>
        // Use a safe wrapper to avoid global scope pollution
        (function() {
            const state = {
                rate: null,
                themeMode: localStorage.getItem('themeMode') || 'system', // system, light, dark
                autoRefresh: true,
                secondsRemaining: 30,
                lastSource: 'thb',
                items: [
                    { name: "Coffee", price: 65, icon: "â˜•" },
                    { name: "Street Food", price: 50, icon: "ðŸœ" },
                    { name: "BTS SkyTrain", price: 35, icon: "ðŸš‡" },
                    { name: "Cinema Ticket", price: 240, icon: "ðŸŽ¬" },
                    { name: "iPhone 17 Pro", price: 43900, icon: "ðŸ“±" },
                    { name: "Monthly Rent", price: 12000, icon: "ðŸ " },
                    { name: "Gasoline (1L)", price: 38, icon: "â›½" },
                    { name: "Gold (1 Baht Weight)", price: 70000, icon: "ðŸ“€" },
                    { name: "Tesla Model 3", price: 1439000, icon: "ðŸš—" }
                ]
            };

            const els = {
                thb: document.getElementById('thb-input'),
                sat: document.getElementById('sat-input'),
                btc: document.getElementById('btc-input'),
                tickerBtc: document.getElementById('ticker-btc-thb'),
                tickerSat: document.getElementById('ticker-thb-sat'),
                refreshBtn: document.getElementById('refresh-btn'),
                themeToggle: document.getElementById('theme-toggle'),
                themeIcon: document.getElementById('theme-icon'),
                themeText: document.getElementById('theme-text'),
                statusText: document.getElementById('status-text'),
                statusPill: document.getElementById('status-pill'),
                countdown: document.getElementById('countdown'),
                grid: document.getElementById('comparison-grid'),
                toast: document.getElementById('toast')
            };

            function init() {
                setupTheme();
                fetchRate();
                setupListeners();
                startTimer();
            }

            function setupTheme() {
                applyTheme();

                // Listen for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                    if (state.themeMode === 'system') {
                        applyTheme();
                    }
                });
            }

            function applyTheme() {
                const isDarkSystem = window.matchMedia('(prefers-color-scheme: dark)').matches;
                let activeTheme = state.themeMode;
                
                if (state.themeMode === 'system') {
                    activeTheme = isDarkSystem ? 'dark' : 'light';
                    els.themeIcon.textContent = 'ðŸŒ“';
                    els.themeText.textContent = 'System';
                } else if (state.themeMode === 'light') {
                    els.themeIcon.textContent = 'â˜€ï¸';
                    els.themeText.textContent = 'Light';
                } else {
                    els.themeIcon.textContent = 'ðŸŒ™';
                    els.themeText.textContent = 'Dark';
                }

                document.documentElement.setAttribute('data-theme', activeTheme);
            }

            function toggleTheme() {
                // Cycle: System -> Light -> Dark -> System
                if (state.themeMode === 'system') {
                    state.themeMode = 'light';
                } else if (state.themeMode === 'light') {
                    state.themeMode = 'dark';
                } else {
                    state.themeMode = 'system';
                }

                localStorage.setItem('themeMode', state.themeMode);
                applyTheme();
            }

            async function fetchRate() {
                els.refreshBtn.disabled = true;
                els.statusText.textContent = "Updating...";
                
                try {
                    const response = await fetch(`https://api.bitkub.com/api/market/ticker?sym=THB_BTC&t=${Date.now()}`);
                    const data = await response.json();
                    
                    if (data.THB_BTC && data.THB_BTC.last) {
                        state.rate = data.THB_BTC.last;
                        updateTicker();
                        recalculate(state.lastSource);
                        updateComparison();
                        
                        els.statusPill.classList.remove('offline');
                        els.statusText.textContent = "Live Sync";
                        state.secondsRemaining = 30;
                    }
                } catch (err) {
                    console.error("Fetch failed", err);
                    els.statusPill.classList.add('offline');
                    els.statusText.textContent = "Offline Mode";
                    if (!state.rate) state.rate = 3200000;
                } finally {
                    els.refreshBtn.disabled = false;
                }
            }

            function updateTicker() {
                els.tickerBtc.textContent = `1 BTC = à¸¿${state.rate.toLocaleString('th-TH', {minimumFractionDigits: 0})}`;
                const satsPerThb = Math.round(100000000 / state.rate);
                els.tickerSat.textContent = `1 THB â‰ˆ ${satsPerThb.toLocaleString()} sats`;
            }

            function setupListeners() {
                els.thb.oninput = (e) => handleInput(e, 'thb');
                els.sat.oninput = (e) => handleInput(e, 'sat');
                els.btc.oninput = (e) => handleInput(e, 'btc');

                els.refreshBtn.onclick = fetchRate;
                els.themeToggle.onclick = toggleTheme;
            }

            function formatWithCommas(value, isBTC = false) {
                if (!value) return '';
                const parts = value.toString().split('.');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                if (isBTC && parts.length > 1) {
                    return parts[0] + '.' + parts[1].substring(0, 8);
                }
                return parts[0];
            }

            function handleInput(e, source) {
                let cursorPosition = e.target.selectionStart;
                let originalLength = e.target.value.length;
                
                let rawVal = e.target.value.replace(/[^0-9.]/g, '');
                if ((rawVal.match(/\./g) || []).length > 1) rawVal = rawVal.slice(0, -1);
                
                if (source !== 'btc' && rawVal.includes('.')) {
                    rawVal = rawVal.split('.')[0];
                }

                state.lastSource = source;
                
                const formatted = formatWithCommas(rawVal, source === 'btc');
                e.target.value = formatted;

                let newLength = formatted.length;
                cursorPosition = cursorPosition + (newLength - originalLength);
                e.target.setSelectionRange(cursorPosition, cursorPosition);

                recalculate(source);
            }

            function recalculate(source) {
                if (!state.rate) return;

                const getVal = (el) => parseFloat(el.value.replace(/,/g, '')) || 0;
                const val = getVal(els[source]);

                if (source === 'thb') {
                    const btc = val / state.rate;
                    els.sat.value = formatWithCommas(Math.round(btc * 100000000));
                    els.btc.value = formatWithCommas(btc.toFixed(8), true);
                } else if (source === 'sat') {
                    const btc = val / 100000000;
                    els.thb.value = formatWithCommas(Math.round(btc * state.rate));
                    els.btc.value = formatWithCommas(btc.toFixed(8), true);
                } else if (source === 'btc') {
                    els.thb.value = formatWithCommas(Math.round(val * state.rate));
                    els.sat.value = formatWithCommas(Math.round(val * 100000000));
                }
            }

            function updateComparison() {
                els.grid.innerHTML = '';
                state.items.forEach(item => {
                    const btcVal = item.price / state.rate;
                    const satVal = Math.round(btcVal * 100000000);
                    
                    const card = document.createElement('div');
                    card.className = 'comparison-card';
                    card.innerHTML = `
                        <div class="item-header">
                            <span>${item.icon}</span>
                        </div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-thb">à¸¿${item.price.toLocaleString()}</div>
                        <div class="item-sat">${satVal.toLocaleString()} sats</div>
                        <div class="item-btc">${btcVal.toFixed(8)} BTC</div>
                    `;
                    els.grid.appendChild(card);
                });
            }

            function startTimer() {
                setInterval(() => {
                    if (state.secondsRemaining > 0) {
                        state.secondsRemaining--;
                        els.countdown.textContent = `(${state.secondsRemaining}s)`;
                    } else {
                        fetchRate();
                    }
                }, 1000);
            }

            window.copyValue = (id) => {
                const input = document.getElementById(id);
                if (!input.value) return;
                
                const el = document.createElement('textarea');
                el.value = input.value.replace(/,/g, ''); 
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);

                els.toast.classList.add('show');
                setTimeout(() => els.toast.classList.remove('show'), 2000);
            };

            init();
        })();
    </script>
</body>
</html>
